/* Drug_Master_Report */
create or replace FUNCTION GET_DRUG_MASTER_REP_FN (P_DATE1 VARCHAR2, P_DATE2 VARCHAR2) RETURN SYS_REFCURSOR AS
        P_VALUE SYS_REFCURSOR;
BEGIN
    OPEN P_VALUE FOR
    SELECT
        TRIM(LTRIM(RTRIM(A.T_LANG2_NAME))) PRDUCT_NAME,
        NVL(B.T_MOH_COST,0) MOH_COST,
        NVL(B.T_MOH_PRICE,0) MOH_PRICE,
        NVL(B.T_SUT_PRICE,0) SUT_PRICE,
        A.T_ITEM_CODE ITEM_CODE,
        to_char(A.T_UPD_DATE,'YYYY-MM-DD')||'T00:00:00' T_UPD_DATE
    FROM
        T30008 A, T30006 B
    WHERE
    A.T_DRUG_MASTER_CODE=B.T_DRUG_MASTER_CODE AND
    A.T_ACTIVE_FLAG='1' AND
    to_char(A.T_UPD_DATE,'RRRR-MM-DD') BETWEEN NVL(P_DATE1,to_char(A.T_UPD_DATE,'RRRR-MM-DD')) AND NVL(P_DATE2,to_char(SYSDATE,'RRRR-MM-DD')) 
    order by TRIM(LTRIM(RTRIM(A.T_LANG2_NAME)));
    RETURN P_VALUE;

exception when no_data_found then
OPEN P_VALUE FOR SELECT 'No Data Found!' from dual;
RETURN P_VALUE;
END;
/*
select get_drug_master_rep_fn('2016-jan-01','2018-jan-01') from dual;
*/
/* Result */
/*
{<PRDUCT_NAME=10mg CHEWING BAG Z2,MOH_COST=39,MOH_PRICE=12,SUT_PRICE=30,ITEM_CODE=null,T_UPD_DATE=2017-05-02T00:00:00>,<PRDUCT_NAME=200mg CHEWING BAG 2,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=5,ITEM_CODE=511612,T_UPD_DATE=2017-04-16T00:00:00>,<PRDUCT_NAME=500mg ORAL TABLET 1,MOH_COST=2,MOH_PRICE=2.2,SUT_PRICE=4,ITEM_CODE=507390,T_UPD_DATE=2017-05-02T00:00:00>,<PRDUCT_NAME=500mg RECTAL SUPPOSITORY 1,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=508540,T_UPD_DATE=2017-04-20T00:00:00>,<PRDUCT_NAME=665mg ORAL BEXICAP 02,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=90,ITEM_CODE=507322,T_UPD_DATE=2017-05-02T00:00:00>,<PRDUCT_NAME=ALBUMIN KABI(R)  test CHEWABLE AMPOULE,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=511622,T_UPD_DATE=2017-04-20T00:00:00>,<PRDUCT_NAME=BREATHING BAG,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=511615,T_UPD_DATE=2017-04-20T00:00:00>,<PRDUCT_NAME=CEENU  150mg ORAL CAPSUL 1,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=508685,T_UPD_DATE=2017-04-20T00:00:00>,<PRDUCT_NAME=CEENU  6 monts Diskus Bar,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=511619,T_UPD_DATE=2017-04-20T00:00:00>,<PRDUCT_NAME=NAPA 120mg/5ml(60ml) ORAL SUSPENSION 12,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=25,ITEM_CODE=508542,T_UPD_DATE=2017-05-02T00:00:00>,<PRDUCT_NAME=NAPA EXTEND 30mg DISPERSABLE Accuhaler(DPI) Z2,MOH_COST=32,MOH_PRICE=12,SUT_PRICE=12,ITEM_CODE=null,T_UPD_DATE=2017-05-02T00:00:00>,<PRDUCT_NAME=NAPA EXTEND 30mg DISPERSABLE Accuhaler(DPI) Z2,MOH_COST=32,MOH_PRICE=12,SUT_PRICE=12,ITEM_CODE=511629,T_UPD_DATE=2017-05-02T00:00:00>,<PRDUCT_NAME=PEP ORAL SYRUP 100ml,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=511603,T_UPD_DATE=2017-01-01T00:00:00>,<PRDUCT_NAME=TIVIZID  300+150+300 mg ORAL TABLET 1,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=505122,T_UPD_DATE=2017-04-19T00:00:00>,<PRDUCT_NAME=Undefined 200mg DISPERSABLE BELT 2,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=511613,T_UPD_DATE=2017-04-17T00:00:00>,<PRDUCT_NAME=VENTOLIN  Respiratory solution,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=510740,T_UPD_DATE=2017-01-02T00:00:00>,<PRDUCT_NAME=VENTOLIN  Respiratory solution,MOH_COST=0,MOH_PRICE=0,SUT_PRICE=0,ITEM_CODE=507384,T_UPD_DATE=2017-01-02T00:00:00>,}
*/
/*
10mg CHEWING BAG Z2	39	12	30		2017-05-02T00:00:00
200mg CHEWING BAG 2	0	0	5	511612	2017-04-16T00:00:00
500mg ORAL TABLET 1	2	2.2	4	507390	2017-05-02T00:00:00
500mg RECTAL SUPPOSITORY 1	0	0	0	508540	2017-04-20T00:00:00
665mg ORAL BEXICAP 02	0	0	90	507322	2017-05-02T00:00:00
ALBUMIN KABI(R)  test CHEWABLE AMPOULE	0	0	0	511622	2017-04-20T00:00:00
BREATHING BAG	0	0	0	511615	2017-04-20T00:00:00
CEENU  150mg ORAL CAPSUL 1	0	0	0	508685	2017-04-20T00:00:00
CEENU  6 monts Diskus Bar	0	0	0	511619	2017-04-20T00:00:00
NAPA 120mg/5ml(60ml) ORAL SUSPENSION 12	0	0	25	508542	2017-05-02T00:00:00
NAPA EXTEND 30mg DISPERSABLE Accuhaler(DPI) Z2	32	12	12		2017-05-02T00:00:00
NAPA EXTEND 30mg DISPERSABLE Accuhaler(DPI) Z2	32	12	12	511629	2017-05-02T00:00:00
PEP ORAL SYRUP 100ml	0	0	0	511603	2017-01-01T00:00:00
TIVIZID  300+150+300 mg ORAL TABLET 1	0	0	0	505122	2017-04-19T00:00:00
Undefined 200mg DISPERSABLE BELT 2	0	0	0	511613	2017-04-17T00:00:00
VENTOLIN  Respiratory solution	0	0	0	510740	2017-01-02T00:00:00
VENTOLIN  Respiratory solution	0	0	0	507384	2017-01-02T00:00:00
*/
